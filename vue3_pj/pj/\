<template>
  <div class="player">
    <button class="operation" v-if="playBoo" @click="play"><img src="../../assets/player/play.png" alt="" ></button>
    <button class="operation" v-else @click="stop"><img src="../../assets/player/stop.png" alt=""></button>
  </div>
</template>


<script>
import { ref } from 'vue'
export default {
  props:{
    name:String
  },
  setup(props,context) {
        // 创建audio实例
    let name = props.name
    let url = ref('http://0.0.0.0:8000/music/list/'+name)
    let playBoo = ref(true)
    const audio = new Audio(url.value) 
    // audio.play()
    // audio.controls = true
    // audio.autoplay = true

    const play = () => {
      playBoo.value = !playBoo.value
      audio.play()
      localStorage.setItem('MusicName', name)
    }
    const stop = () =>{
      audio.pause()
      playBoo.value = !playBoo.value
      // console.log(String((audio.currentTime/audio.duration)*100).substr(0,4)+'%');
    }
    audio.addEventListener('ended',()=>{
      let nextName = null
      context.emit('eventEnd',(nextName)=>{
        audio.src = 'http://0.0.0.0:8000/music/list/'+nextName
        localStorage.setItem('MusicName', nextName)
      })
      audio.autoplay = true
      audio.play()
      playBoo.value = !playBoo.value
    })
    return{
      name,
      playBoo,
      play,
      stop

    }
    
  },
}
</script>

<style lang="scss">
.player{
  width: 100%;
  height: 50px;
  // 透明效果
  opacity: 0.8;
  background-color: rgb(71, 70, 70);
  position: absolute;
  zoom: 1;
  .operation{
    background-color: rgb(71, 70, 70);
    border: 0;
  }
  button:hover{
    cursor: pointer;
    img:hover{
    -webkit-filter: brightness(250%);
    filter: brightness(250%);

    }
  }
  img{
    -webkit-filter: contrast(150%);
    width: 30px;
    border-radius: 100%;
    border: 2px solid #FFF;
    background-color: rgb(71, 70, 70);

  }
}
  
</style>
